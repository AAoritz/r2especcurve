# r2especcurve
A specification curve builder for the R2E project. Uses the data format generated by following the R2E reproduction protocol.

![Example specification curve](example_speccurve.png)

If you are an R user, to use:

1. Do `remotes::install_github('NickCH-K/r2especcurve')`
2. Load up your data and `library(r2especcurve)`.
3. See `help(speccurve)` for example code. You'll need to give it your data set and the column names of your analytical decisions, at least.

If you are a Stata user and do not want to install R:

1. Go to [RStudio Cloud](https://posit.cloud) and create a free account.
2. Click New Project -> New RStudio project
3. In the bottom-right panel, click "Upload" to upload your reproduction file which fits the R2E specifications. Note this assumes in particular that you effect is stored in a column called `beta` and your SEs in a column called `se` (case sensitive).
4. Run the below code by copy/pasting it into the console (this will take a while as it needs to install some packages). Be sure to change the `revised_reproduction_output.dta` to match your own filename. Also note that this will open up a help file on the specification curve function that you can use to adjust it if you like.

```
install.packages(c('haven','remotes','data.table','ggplot2','patchwork'))
remotes::install_github('NickCH-K/r2especcurve')
library(r2especcurve)

help(spec_curve)

dat = haven::read_dta('revised_reproduction_output.dta')
```

5. Run the below code to generate a specification curve graph. Be sure to change (a) the `output == 3` to match whatever output you want to make a specification curve for, (b) the `analytical_decision_1` (and so on) column names to match the columns that contain your analytic decisions, (c) the `Specification`, etc., labels for those decision columns, and (d) the `orig_spec_values` values to match the analytic decision values that match the original published study. 

Note that if you have the original values directly, you can replace `orig_spec_values = c(1,1,1)` with `orig_beta_se = c(.5, .2)` to indicate an original beta of .5 and a SE of .2, for example. Or remove it (and the preceding comma) entirely to leave the original off the graph.

```
spec_curve(dat[dat$outcome == 3,],
           decision_cols = c('analytical_decision_1',
                             'analytical_decision_2',
                             'analytical_decision_3'),
           decision_labels = c('Specification',
                               'Bandwidth',
                               'Controls'),
           orig_spec_values = c(1,1,1))
```

6. Use the "Zoom" button to zoom in on the result, resize as you like, then right/command-click to save the image.
7. Repeat with your other outcomes.
